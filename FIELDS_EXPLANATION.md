# 📋 شرح تفصيلي لحقول أقسام الصفحة الرئيسية

## 🎯 أين تظهر النماذج؟

النماذج تظهر في **صفحة إدارة الأقسام**:
```
http://localhost:3000/dashboard/homepage/sections
```

عند الضغط على زر **"إضافة قسم جديد"**، ستظهر نافذة منبثقة (Modal) تحتوي على النموذج.

---

## 📝 شرح تفصيلي لكل حقل

### 1️⃣ نوع القسم (section_type) ⭐
**الموقع في النموذج:** أول حقل في الأعلى

```
┌─────────────────────────────┐
│ نوع القسم: [قائمة منسدلة]  │
│   ▸ قسم منتجات             │
│   ▸ قسم فئات               │
└─────────────────────────────┘
```

**📍 مربوط بالداتابيز:** ✅ نعم
- **الجدول:** `homepage_sections`
- **الحقل:** `section_type`
- **القيم المسموحة:** `'products'` أو `'categories'`

**🎯 الوظيفة العملية:** ⭐⭐⭐ (مهم جداً)
- يحدد نوع القسم
- **'products'**: يعرض منتجات (الأكثر استخداماً)
- **'categories'**: يعرض فئات (نادر الاستخدام لأن الفئات تظهر تلقائياً)

**أين يظهر التأثير:**
- يحدد كيف سيجلب البيانات من قاعدة البيانات
- يحدد الأيقونة واللون في صفحة الإدارة

---

### 2️⃣ العنوان (title) ⭐⭐⭐
**الموقع في النموذج:** الحقل الثاني

```
┌─────────────────────────────┐
│ العنوان: [____________]     │
│ مثال: المنتجات الأكثر مبيعاً│
└─────────────────────────────┘
```

**📍 مربوط بالداتابيز:** ✅ نعم
- **الجدول:** `homepage_sections`
- **الحقل:** `title`
- **نوع البيانات:** `character varying` (نص)
- **مطلوب:** ✅ نعم (لا يمكن تركه فارغاً)

**🎯 الوظيفة العملية:** ⭐⭐⭐ (مهم جداً)
**أين يظهر:**
```
┌─────────────────────────────────────────┐
│  📦 المنتجات الأكثر مبيعاً  ← هنا      │
│  ────────────────────────────────────   │
│  🛒 منتج 1   🛒 منتج 2   🛒 منتج 3    │
└─────────────────────────────────────────┘
```
- يظهر كعنوان رئيسي فوق القسم في الصفحة الرئيسية
- يظهر في قائمة الأقسام في لوحة التحكم

---

### 3️⃣ العنوان الفرعي (subtitle) ⭐⭐
**الموقع في النموذج:** الحقل الثالث

```
┌─────────────────────────────────────────┐
│ العنوان الفرعي: [________________]     │
│ مثال: اكتشف المنتجات التي يحبها عملاؤنا│
└─────────────────────────────────────────┘
```

**📍 مربوط بالداتابيز:** ✅ نعم
- **الجدول:** `homepage_sections`
- **الحقل:** `subtitle`
- **نوع البيانات:** `text`
- **مطلوب:** ❌ لا (اختياري)

**🎯 الوظيفة العملية:** ⭐⭐ (مفيد لكن اختياري)
**أين يظهر:**
```
┌─────────────────────────────────────────┐
│  📦 المنتجات الأكثر مبيعاً             │
│  اكتشف المنتجات التي يحبها عملاؤنا ← هنا│
│  ────────────────────────────────────   │
│  🛒 منتج 1   🛒 منتج 2   🛒 منتج 3    │
└─────────────────────────────────────────┘
```
- يظهر أسفل العنوان مباشرة
- يعطي وصف مختصر للقسم
- إذا تركته فارغاً لن يظهر شيء (لن يؤثر على عمل القسم)

---

### 4️⃣ مصدر المنتجات (product_source) ⭐⭐⭐
**الموقع في النموذج:** يظهر فقط إذا اخترت "قسم منتجات"

```
┌─────────────────────────────┐
│ مصدر المنتجات: [قائمة]     │
│   ▸ اختيار يدوي (manual)    │
│   ▸ الأكثر مبيعاً           │
│   ▸ جديد                   │
│   ▸ عروض                   │
│   ▸ من فئة معينة           │
└─────────────────────────────┘
```

**📍 مربوط بالداتابيز:** ✅ نعم
- **الجدول:** `homepage_sections`
- **الحقل:** `settings->>'product_source'` (داخل JSONB)
- **القيم المسموحة:** 
  - `'manual'` - اختيار يدوي
  - `'best_sellers'` - الأكثر مبيعاً
  - `'new'` - جديد
  - `'deals'` - عروض
  - `'category'` - من فئة معينة

**🎯 الوظيفة العملية:** ⭐⭐⭐ (مهم جداً!)

**كيف يعمل في الكود:**
```typescript
// في app/page.tsx (سطر 172-178)
if (settings.product_source === 'best_sellers') {
  query = query.order('sales_count', { ascending: false });
} else if (settings.product_source === 'new') {
  query = query.order('created_at', { ascending: false });
} else if (settings.product_source === 'deals') {
  query = query.not('original_price', 'is', null);
}
```

**الشرح التفصيلي:**

#### 🔹 best_sellers (الأكثر مبيعاً)
- **يجلب:** المنتجات المرتبة حسب `sales_count` (الأعلى أولاً)
- **متطلبات:** يجب أن يكون لديك حقل `sales_count` في جدول `products`
- **⚠️ مشكلة محتملة:** إذا لم يكن الحقل موجود أو كله أصفار، لن يعمل الترتيب بشكل صحيح

#### 🔹 new (جديد)
- **يجلب:** المنتجات المرتبة حسب `created_at` (الأحدث أولاً)
- **متطلبات:** حقل `created_at` موجود تلقائياً ✅
- **يعمل فوراً:** ✅ نعم

#### 🔹 deals (عروض)
- **يجلب:** المنتجات التي لديها `original_price` (السعر الأصلي قبل الخصم)
- **متطلبات:** المنتج يجب أن يكون له سعر أصلي وسعر مخفض
- **مثال:** سعر = 100، سعر أصلي = 150 (يعني خصم 33%)

#### 🔹 category (من فئة معينة)
- **يجلب:** منتجات من فئة معينة فقط
- **متطلبات:** اختيار `category_type` من الحقل التالي
- **مثال:** electrical, plumbing, tools

#### 🔹 manual (يدوي)
- **يجلب:** المنتجات التي تختارها أنت يدوياً
- **متطلبات:** إضافة المنتجات إلى جدول `homepage_section_products`
- **⚠️ ناقص:** لا توجد واجهة لإضافة المنتجات يدوياً (يجب إضافتها عبر SQL أو API)

---

### 5️⃣ نوع الفئة (category_type) ⭐⭐
**الموقع في النموذج:** يظهر فقط إذا اخترت "من فئة معينة"

```
┌─────────────────────────────┐
│ نوع الفئة: [قائمة]         │
│   ▸ أدوات كهربائية         │
│   ▸ أدوات صحية             │
│   ▸ أدوات عامة             │
│   ▸ أخرى                   │
└─────────────────────────────┘
```

**📍 مربوط بالداتابيز:** ✅ نعم
- **الجدول:** `homepage_sections`
- **الحقل:** `settings->>'category_type'` (داخل JSONB)
- **القيم:** `'electrical'`, `'plumbing'`, `'tools'`, `'other'`

**🎯 الوظيفة العملية:** ⭐⭐⭐ (مهم إذا اخترت category)

**كيف يعمل:**
```typescript
// في app/page.tsx (سطر 170-171)
if (settings.product_source === 'category' && settings.category_type) {
  query = query.eq('category_type', settings.category_type);
}
```

**يجلب:** المنتجات التي `category_type` = القيمة المختارة

---

### 6️⃣ التخطيط (layout) ⭐⭐⭐
**الموقع في النموذج:** في صف مع الأعمدة وعدد المنتجات

```
┌─────────────────────────────┐
│ التخطيط: [قائمة]           │
│   ▸ شبكة (grid)             │
│   ▸ سلايدر (slider)         │
└─────────────────────────────┘
```

**📍 مربوط بالداتابيز:** ✅ نعم
- **الجدول:** `homepage_sections`
- **الحقل:** `settings->>'layout'` (داخل JSONB)
- **القيم:** `'grid'` أو `'slider'`

**🎯 الوظيفة العملية:** ⭐⭐⭐ (مهم جداً!)

**كيف يعمل:**
```typescript
// في DynamicProductSection.tsx (سطر 66-150)
const GridLayout = () => { ... }  // شبكة ثابتة
const SliderLayout = () => { ... } // سلايدر متحرك
```

**الفرق:**
- **grid**: يعرض جميع المنتجات في شبكة ثابتة
- **slider**: يعرض المنتجات في سلايدر متحرك مع أسهم وnقاط

---

### 7️⃣ الأعمدة (columns) ⭐⭐⭐
**الموقع في النموذج:** في نفس الصف مع التخطيط

```
┌─────────────────────────────┐
│ الأعمدة: [____]             │
│ (من 2 إلى 6)               │
└─────────────────────────────┘
```

**📍 مربوط بالداتابيز:** ✅ نعم
- **الجدول:** `homepage_sections`
- **الحقل:** `settings->>'columns'` (داخل JSONB)
- **نوع:** رقم (integer)
- **النطاق:** 2-6

**🎯 الوظيفة العملية:** ⭐⭐⭐ (مهم جداً!)

**كيف يعمل:**
```typescript
// في DynamicProductSection.tsx (سطر 68-74)
const gridCols = {
  2: 'grid-cols-2',
  3: 'sm:grid-cols-3',
  4: 'lg:grid-cols-4',
  5: 'xl:grid-cols-5',
  6: 'xl:grid-cols-6'
};
```

**التأثير البصري:**
- **2 أعمدة:** منتجان في كل صف (مناسب للهواتف)
- **3 أعمدة:** 3 منتجات في كل صف
- **4 أعمدة:** 4 منتجات (الأكثر شيوعاً) ✅
- **5-6 أعمدة:** للشاشات الكبيرة جداً

---

### 8️⃣ عدد المنتجات (product_count) ⭐⭐⭐
**الموقع في النموذج:** في نفس الصف مع التخطيط والأعمدة

```
┌─────────────────────────────┐
│ عدد المنتجات: [____]       │
│ (الحد الأدنى: 1)           │
└─────────────────────────────┘
```

**📍 مربوط بالداتابيز:** ✅ نعم
- **الجدول:** `homepage_sections`
- **الحقل:** `settings->>'product_count'` (داخل JSONB)
- **نوع:** رقم (integer)
- **القيمة الافتراضية:** 8

**🎯 الوظيفة العملية:** ⭐⭐⭐ (مهم جداً!)

**كيف يعمل:**
```typescript
// في app/page.tsx (سطر 180)
query = query.limit(settings.product_count || 8);
```

**يحدد:** كم منتج سيظهر في القسم
- **مثال:** إذا اخترت 8، سيظهر 8 منتجات فقط
- **ملاحظة:** للأقسام اليدوية، يجب إضافة منتجات كافية

---

### 9️⃣ إظهار زر "عرض الكل" (show_view_all) ⭐⭐
**الموقع في النموذج:** تحت عدد المنتجات

```
┌─────────────────────────────┐
│ ☑ إظهار زر "عرض الكل"      │
└─────────────────────────────┘
```

**📍 مربوط بالداتابيز:** ✅ نعم
- **الجدول:** `homepage_sections`
- **الحقل:** `settings->>'show_view_all'` (داخل JSONB)
- **نوع:** boolean (true/false)

**🎯 الوظيفة العملية:** ⭐⭐ (مفيد)

**كيف يعمل:**
```typescript
// في DynamicProductSection.tsx (سطر 170-180 تقريباً)
{settings.show_view_all && viewAllLink && (
  <Link href={viewAllLink}>
    <button>عرض الكل</button>
  </Link>
)}
```

**التأثير:**
```
┌─────────────────────────────────────────┐
│  📦 المنتجات الأكثر مبيعاً   [عرض الكل]│ ← الزر هنا
│  ────────────────────────────────────   │
│  🛒 منتج 1   🛒 منتج 2   🛒 منتج 3    │
└─────────────────────────────────────────┘
```

**الرابط:**
- للـ best_sellers: `/products?filter=best_sellers`
- للـ new: `/products?filter=new`
- للـ deals: `/products?filter=deals`
- للـ category: `/category/electrical` (مثلاً)

---

### 🔟 الترتيب (sort_order) ⭐⭐⭐
**الموقع في النموذج:** تحت إعدادات المنتجات

```
┌─────────────────────────────┐
│ الترتيب: [____]             │
│ (الحد الأدنى: 0)           │
└─────────────────────────────┘
```

**📍 مربوط بالداتابيز:** ✅ نعم
- **الجدول:** `homepage_sections`
- **الحقل:** `sort_order`
- **نوع:** integer
- **القيمة الافتراضية:** 0

**🎯 الوظيفة العملية:** ⭐⭐⭐ (مهم جداً!)

**كيف يعمل:**
```typescript
// في app/page.tsx (سطر 122)
.order('sort_order', { ascending: true });
```

**الترتيب:**
- الرقم **الأصغر** يظهر **أولاً**
- مثال:
  ```
  sort_order = 10 → يظهر أولاً
  sort_order = 20 → يظهر ثانياً
  sort_order = 30 → يظهر ثالثاً
  ```

**نصيحة:** استخدم أرقام متباعدة (10, 20, 30...) لسهولة إعادة الترتيب لاحقاً

---

### 1️⃣1️⃣ مفعّل (is_active) ⭐⭐⭐
**الموقع في النموذج:** في الأسفل

```
┌─────────────────────────────┐
│ ☑ مفعّل                     │
└─────────────────────────────┘
```

**📍 مربوط بالداتابيز:** ✅ نعم
- **الجدول:** `homepage_sections`
- **الحقل:** `is_active`
- **نوع:** boolean
- **القيمة الافتراضية:** true

**🎯 الوظيفة العملية:** ⭐⭐⭐ (مهم جداً!)

**كيف يعمل:**
```typescript
// في app/page.tsx (سطر 121)
.eq('is_active', true);
```

**التأثير:**
- ✅ **مفعّل (true)**: القسم يظهر في الصفحة الرئيسية
- ❌ **معطّل (false)**: القسم **لا يظهر** في الصفحة الرئيسية (مخفي)

**الفائدة:** إخفاء/إظهار القسم بدون حذفه

---

## ⚠️ الحقول الناقصة والمشاكل المحتملة

### 1. حقل `sales_count` في جدول products
**المشكلة:** مطلوب لـ "الأكثر مبيعاً" لكن قد لا يكون موجود أو محدّث

**الحل:**
```sql
-- إضافة الحقل إذا لم يكن موجود
ALTER TABLE products ADD COLUMN IF NOT EXISTS sales_count INTEGER DEFAULT 0;

-- تحديثه من جدول الطلبات
UPDATE products p
SET sales_count = (
  SELECT COALESCE(SUM(oi.quantity), 0)
  FROM order_items oi
  WHERE oi.product_id = p.id
);
```

### 2. واجهة إضافة منتجات للأقسام اليدوية
**المشكلة:** لا توجد واجهة في لوحة التحكم لإضافة منتجات يدوياً

**الحل المؤقت:** استخدام SQL:
```sql
INSERT INTO homepage_section_products (section_id, product_id, sort_order)
VALUES ('section-id', 'product-id', 0);
```

**الحل الأفضل:** إنشاء صفحة `/dashboard/homepage/sections/[id]/products` لإدارة المنتجات

### 3. معاينة القسم قبل الحفظ
**المشكلة:** لا يمكن معاينة شكل القسم قبل حفظه

**الحل المقترح:** إضافة زر "معاينة" في النموذج

---

## 📊 ملخص أهمية كل حقل

| الحقل | الأهمية | مربوط بDB | يؤثر على العرض |
|-------|---------|-----------|----------------|
| **section_type** | ⭐⭐⭐ | ✅ | ✅ |
| **title** | ⭐⭐⭐ | ✅ | ✅ |
| **subtitle** | ⭐⭐ | ✅ | ✅ (اختياري) |
| **product_source** | ⭐⭐⭐ | ✅ | ✅ |
| **category_type** | ⭐⭐ | ✅ | ✅ (شرطي) |
| **layout** | ⭐⭐⭐ | ✅ | ✅ |
| **columns** | ⭐⭐⭐ | ✅ | ✅ |
| **product_count** | ⭐⭐⭐ | ✅ | ✅ |
| **show_view_all** | ⭐⭐ | ✅ | ✅ |
| **sort_order** | ⭐⭐⭐ | ✅ | ✅ |
| **is_active** | ⭐⭐⭐ | ✅ | ✅ |

---

## ✅ الخلاصة

**جميع الحقول:**
- ✅ مربوطة بقاعدة البيانات
- ✅ لها وظيفة عملية حقيقية
- ✅ تؤثر على عرض القسم في الصفحة الرئيسية
- ✅ ليست مجرد نصوص أو أرقام ديكور

**لا يوجد حقل بلا فائدة!** كل حقل له دور محدد في النظام.
