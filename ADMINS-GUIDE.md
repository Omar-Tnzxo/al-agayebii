# دليل إدارة حسابات المديرين

## نظرة عامة

نظام إدارة حسابات المديرين مؤمن بالكامل ويستخدم:
- تشفير bcrypt قوي لكلمات المرور
- نظام دعوات لإنشاء حسابات جديدة
- مراقبة دورية لحالة الحسابات
- منع حذف المديرين الأقدم

## إنشاء حساب مدير جديد

### الخطوة 1: إنشاء كود دعوة

1. افتح **Supabase Dashboard**
2. اذهب إلى **SQL Editor**
3. افتح الملف `create-invitation-code.sql`
4. انسخ محتوى الملف والصقه في SQL Editor
5. اضغط **Run**
6. **انسخ الكود المعروض** (8 أرقام)

### الخطوة 2: التسجيل

1. اذهب إلى صفحة التسجيل: `/s3cur3-r3g1st3r-@dm1n-2025`
2. املأ البيانات:
   - **كود الدعوة**: الكود الذي حصلت عليه من الخطوة 1
   - **البريد الإلكتروني**: admin@example.com
   - **كلمة المرور**: يجب أن تحتوي على:
     - 8 أحرف على الأقل
     - حروف كبيرة (A-Z)
     - حروف صغيرة (a-z)
     - أرقام (0-9)
   - **رقم الهاتف** (اختياري)
3. اضغط **إنشاء الحساب**

### مثال على كلمة مرور صالحة
```
Alagayebi@2025
Admin123456
MyPassword2025
```

## إدارة المديرين من لوحة التحكم

### الوصول إلى صفحة إدارة المديرين

1. سجل دخولك كمدير رئيسي (Super Admin)
2. اذهب إلى: `/dashboard/admins`

### الصلاحيات المتاحة

#### المدير الرئيسي (Super Admin)
- ✅ عرض جميع المديرين
- ✅ إنشاء مديرين جدد
- ✅ تعديل معلومات المديرين
- ✅ تغيير كلمات المرور
- ✅ تفعيل/تعطيل الحسابات
- ✅ حذف المديرين (المُنشأين بعده فقط)

#### المدير العادي (Admin)
- ✅ عرض جميع المديرين
- ✅ تعديل معلوماته الشخصية فقط
- ✅ تغيير كلمة مروره فقط

## الأمان والحماية

### ميزات الأمان المطبقة

1. **تشفير كلمات المرور**
   - bcrypt مع salt عشوائي
   - لا يمكن استرجاع كلمة المرور الأصلية

2. **نظام الدعوات**
   - كود دعوة مطلوب لإنشاء حساب جديد
   - الكود صالح لمرة واحدة فقط
   - ينتهي بعد 7 أيام

3. **مراقبة الجلسات**
   - فحص دوري كل 30 ثانية
   - إخراج تلقائي عند تعطيل الحساب
   - رسالة واضحة عن سبب الإخراج

4. **الحماية من الحذف غير المصرح**
   - لا يمكن حذف مدير تم إنشاؤه قبلك
   - لا يمكن حذف حسابك الخاص
   - الحذف هو في الواقع "تعطيل" للحساب

5. **التحقق من الصلاحيات**
   - كل عملية يتم التحقق من صلاحية المستخدم
   - رسائل خطأ واضحة ومفصلة

## استكشاف الأخطاء

### "كود الدعوة غير صالح"
- تأكد من نسخ الكود بشكل صحيح (8 أرقام)
- تأكد أن الكود لم يتم استخدامه من قبل
- تأكد أن الكود لم ينتهِ (صالح لـ 7 أيام فقط)

### "البريد الإلكتروني مستخدم بالفعل"
- هذا البريد مسجل مسبقاً
- استخدم بريد إلكتروني آخر

### "كلمة المرور يجب أن تحتوي على..."
- تأكد من أن كلمة المرور تحتوي على:
  - حروف كبيرة
  - حروف صغيرة
  - أرقام
  - 8 أحرف على الأقل

### "غير مصرح لك بـ..."
- تحتاج صلاحيات Super Admin لهذه العملية
- تواصل مع المدير الرئيسي

### "تم تعطيل حسابك"
- تواصل مع المدير الرئيسي لإعادة تفعيل حسابك

## أسئلة شائعة

### كيف أغير البريد الإلكتروني؟
1. اذهب إلى `/dashboard/admins`
2. اضغط أيقونة القلم ✏️ بجانب المدير
3. غيّر البريد الإلكتروني
4. احفظ التغييرات

### كيف أغير كلمة المرور؟
1. اذهب إلى `/dashboard/admins`
2. اضغط أيقونة المفتاح 🔑 بجانب المدير
3. أدخل كلمة المرور القديمة (إذا كنت تغير كلمة مرورك)
4. أدخل كلمة المرور الجديدة مرتين
5. احفظ التغييرات

### كيف أعطل حساب مدير؟
1. اذهب إلى `/dashboard/admins`
2. اضغط على مفتاح التبديل بجانب "نشط"
3. سيتم إخراج المدير تلقائياً من لوحة التحكم

### كيف أحذف حساب مدير؟
1. اذهب إلى `/dashboard/admins`
2. اضغط أيقونة سلة المهملات 🗑️
3. أكد الحذف
4. **ملاحظة**: لا يمكنك حذف مدير تم إنشاؤه قبلك

## الدعم الفني

إذا واجهت أي مشكلة:
1. تحقق من console المتصفح (F12)
2. تحقق من logs الخادم
3. تأكد من أن قاعدة البيانات تحتوي على جدول `invitation_codes`
4. تأكد من تشغيل جميع migrations

## ملاحظات أمنية مهمة

⚠️ **لا تشارك أكواد الدعوة علناً**
⚠️ **غيّر كلمات المرور الافتراضية فوراً**
⚠️ **استخدم كلمات مرور قوية ومعقدة**
⚠️ **لا تحفظ كلمات المرور في ملفات نصية**
⚠️ **راجع قائمة المديرين بانتظام**
