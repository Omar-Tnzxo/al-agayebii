-- ========================================
-- SQL Script: إنشاء كود دعوة لتسجيل مدير جديد
-- ========================================
-- التعليمات:
-- 1. افتح Supabase Dashboard
-- 2. اذهب إلى SQL Editor
-- 3. انسخ والصق هذا السكريبت
-- 4. اضغط Run لإنشاء كود دعوة جديد
-- 5. انسخ الكود المعروض في النتائج
-- ========================================

-- إنشاء كود دعوة صالح لمرة واحدة، ينتهي بعد 7 أيام
INSERT INTO invitation_codes (
  code,
  max_uses,
  current_uses,
  expires_at,
  created_by,
  is_active
) VALUES (
  -- كود عشوائي مكون من 8 أرقام
  LPAD(FLOOR(RANDOM() * 100000000)::TEXT, 8, '0'),
  1, -- صالح لمرة واحدة فقط
  0, -- لم يتم استخدامه بعد
  NOW() + INTERVAL '7 days', -- صالح لمدة 7 أيام
  NULL, -- يمكنك وضع معرف المدير الذي أنشأ الكود
  true -- الكود نشط
)
RETURNING 
  code AS "كود الدعوة",
  max_uses AS "عدد مرات الاستخدام المسموحة",
  expires_at AS "ينتهي في",
  created_at AS "تم الإنشاء في";

-- ========================================
-- ملاحظات مهمة:
-- ========================================
-- 1. الكود صالح لإنشاء حساب مدير واحد فقط
-- 2. الكود صالح لمدة 7 أيام من تاريخ الإنشاء
-- 3. بعد استخدام الكود، سيصبح غير صالح تلقائياً
-- 4. لإنشاء كود جديد، شغل هذا السكريبت مرة أخرى
-- ========================================

-- للتحقق من الأكواد الموجودة وحالتها:
-- SELECT 
--   code,
--   max_uses,
--   current_uses,
--   expires_at,
--   is_active,
--   created_at
-- FROM invitation_codes
-- ORDER BY created_at DESC;

-- لتعطيل كود معين:
-- UPDATE invitation_codes 
-- SET is_active = false 
-- WHERE code = 'الكود_هنا';

-- لحذف الأكواد المنتهية:
-- DELETE FROM invitation_codes 
-- WHERE expires_at < NOW() OR current_uses >= max_uses;
