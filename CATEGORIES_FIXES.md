# ุฅุตูุงุญ ูุดููุฉ ุตูุฑ ุงูุชุตูููุงุช - ุงูุญู ุงูููุงุฆู

## ๐ ุงููุดููุฉ ุงูููุชุดูุฉ

ุจุนุฏ ุฅุถุงูุฉ logging ุดุงููุ ุงูุชุดููุง ุงููุดููุฉ ุงูุญููููุฉ:

### ุงูุณุจุจ: Race Condition (ุชุณุงุจู ุงูุนูููุงุช)

ุนูุฏ ุงูุถุบุท ุนูู "ุญูุธ"ุ ูุงู ูุชู ุฅุฑุณุงู ุงูุจูุงูุงุช **ูุจู** ุงูุชูุงู ุฑูุน ุงูุตูุฑุฉ!

#### ุงูุฏููู ูู Logs:

```
1. ๐ค ุฅุฑุณุงู ุจูุงูุงุช ุชุญุฏูุซ ุงูุชุตููู: {..., image: '', ...}  โ ูุงุฑุบ!
2. โ ุชู ุฑูุน ุงูุตูุฑุฉ ุจูุฌุงุญ: https://...                      โ ุจุนุฏ ุงูุฅุฑุณุงู!
3. ๐ฅ ุชุญุฏูุซ ุตูุฑุฉ ุงูุชุตููู ูู state: https://...              โ ูุชุฃุฎุฑ ุฌุฏุงู!
```

ุงููุณุชุฎุฏู ูุงู ูุถุบุท "ุญูุธ" ุจุณุฑุนุฉ ูุจู ุฃู ุชูุชูู ุนูููุฉ ุฑูุน ุงูุตูุฑุฉุ ูุฐุง ูุงู `imageUrl` state ูุง ูุฒุงู ูุงุฑุบุงู.

## โ ุงูุญู ุงููุทุจู

### 1. ุฅุถุงูุฉ callback ููู ImageUpload Component

ุชู ุฅุถุงูุฉ prop ุฌุฏูุฏ `onUploadingChange` ูุฅุฎุจุงุฑ ุงููููู ุงูุฃุจ ุนู ุญุงูุฉ ุงูุฑูุน:

```typescript
interface ImageUploadProps {
  onImageUploaded: (imageUrl: string) => void;
  currentImage?: string;
  className?: string;
  onUploadingChange?: (isUploading: boolean) => void; // โ ุฌุฏูุฏ
}
```

### 2. ุชุญุฏูุซ ุญุงูุฉ ุงูุฑูุน ูู ImageUpload

```typescript
setUploading(true);
onUploadingChange?.(true); // ุฅุฎุจุงุฑ ุงููููู ุงูุฃุจ ุฃู ุงูุฑูุน ุจุฏุฃ

try {
  // ... ุฑูุน ุงูุตูุฑุฉ
  onImageUploaded(result.imageUrl);
} finally {
  setUploading(false);
  onUploadingChange?.(false); // ุฅุฎุจุงุฑ ุงููููู ุงูุฃุจ ุฃู ุงูุฑูุน ุงูุชูู
}
```

### 3. ุชุนุทูู ุฒุฑ ุงูุญูุธ ุฃุซูุงุก ุฑูุน ุงูุตูุฑุฉ

ูู ุตูุญุฉ ุงูุชุนุฏูู (`edit/[type]/page.tsx`):

```typescript
const [imageUploading, setImageUploading] = useState(false);

// ูู ุงูู JSX
<ImageUpload
  onImageUploaded={(url) => setImageUrl(url)}
  currentImage={imageUrl}
  onUploadingChange={setImageUploading} // โ ุชุชุจุน ุญุงูุฉ ุงูุฑูุน
/>

// ุฒุฑ ุงูุญูุธ
<button
  type="submit"
  disabled={loading || imageUploading} // โ ูุนุทู ุฃุซูุงุก ุงูุฑูุน
>
  {imageUploading ? 'ุฌุงุฑู ุฑูุน ุงูุตูุฑุฉ...' : 'ุญูุธ ุงูุชุนุฏููุงุช'}
</button>
```

ููุณ ุงูุชุทุจูู ูู ุตูุญุฉ ุงูุฅุถุงูุฉ (`new/page.tsx`).

### 4. ุฅุถุงูุฉ ุฑุณุงูุฉ ุชูุจูู ูููุณุชุฎุฏู

```typescript
{imageUploading && (
  <p className="text-sm text-blue-600 mt-2">
    โณ ุฌุงุฑู ุฑูุน ุงูุตูุฑุฉุ ุงูุฑุฌุงุก ุงูุงูุชุธุงุฑ...
  </p>
)}
```

## ๐ ุงููููุงุช ุงููุนุฏูุฉ

1. โ `components/ImageUpload.tsx`
   - ุฅุถุงูุฉ `onUploadingChange` prop
   - ุงุณุชุฏุนุงุก callback ุนูุฏ ุจุฏุก/ุงูุชูุงุก ุงูุฑูุน

2. โ `app/dashboard/categories/edit/[type]/page.tsx`
   - ุฅุถุงูุฉ `imageUploading` state
   - ุชุนุทูู ุฒุฑ ุงูุญูุธ ุฃุซูุงุก ุงูุฑูุน
   - ุฅุถุงูุฉ ุฑุณุงูุฉ ุชูุจูู

3. โ `app/dashboard/categories/new/page.tsx`
   - ููุณ ุงูุชุนุฏููุงุช ูู ุตูุญุฉ ุงูุชุนุฏูู

## ๐ฏ ุงููุชูุฌุฉ

ุงูุขู:
- โ ุฒุฑ "ุญูุธ" ูููู ูุนุทูุงู ุฃุซูุงุก ุฑูุน ุงูุตูุฑุฉ
- โ ุงููุณุชุฎุฏู ูุฑู ุฑุณุงูุฉ "ุฌุงุฑู ุฑูุน ุงูุตูุฑุฉ..." ุนูู ุงูุฒุฑ
- โ ุงููุณุชุฎุฏู ูุฑู ุชูุจูู ุชุญุช ูููู ุงูุตูุฑุฉ
- โ ูุง ูููู ุงูุญูุธ ุญุชู ุชูุชูู ุนูููุฉ ุงูุฑูุน
- โ ุงูุตูุฑุฉ ุชูุญูุธ ูุน ุงูุชุตููู ุจุดูู ุตุญูุญ

## ๐งช ุงูุงุฎุชุจุงุฑ

1. ุงุฐูุจ ุฅูู `/dashboard/categories/edit/electrical`
2. ุงุฎุชุฑ ุตูุฑุฉ ุฌุฏูุฏุฉ
3. ูุงุญุธ:
   - ุฒุฑ "ุญูุธ" ุฃุตุจุญ ูุนุทูุงู
   - ุงููุต ุชุบูุฑ ุฅูู "ุฌุงุฑู ุฑูุน ุงูุตูุฑุฉ..."
   - ุฑุณุงูุฉ "โณ ุฌุงุฑู ุฑูุน ุงูุตูุฑุฉุ ุงูุฑุฌุงุก ุงูุงูุชุธุงุฑ..." ุชุธูุฑ
4. ุงูุชุธุฑ ุญุชู ููุชูู ุงูุฑูุน
5. ุฒุฑ "ุญูุธ" ูุตุจุญ ูุดุทุงู ูุฑุฉ ุฃุฎุฑู
6. ุงุถุบุท "ุญูุธ"
7. โ ุงูุตูุฑุฉ ุชูุญูุธ ูุน ุงูุชุตููู ุจูุฌุงุญ!

## ๐ ููุงุฑูุฉ ูุจู ูุจุนุฏ

### ูุจู ุงูุฅุตูุงุญ:
```
ุงููุณุชุฎุฏู ูุฎุชุงุฑ ุตูุฑุฉ โ ุงููุณุชุฎุฏู ูุถุบุท ุญูุธ ููุฑุงู โ image: '' โ
```

### ุจุนุฏ ุงูุฅุตูุงุญ:
```
ุงููุณุชุฎุฏู ูุฎุชุงุฑ ุตูุฑุฉ โ ุฒุฑ ุงูุญูุธ ูุนุทู โ ุฑูุน ุงูุตูุฑุฉ โ ุฒุฑ ุงูุญูุธ ูุดุท โ ุงููุณุชุฎุฏู ูุถุบุท ุญูุธ โ image: 'https://...' โ
```

## ๐๏ธ ุชูุธูู (ุงุฎุชูุงุฑู)

ููููู ุงูุขู ุฅุฒุงูุฉ ุฌููุน ุฃุณุทุฑ `console.log` ููุชุดุฎูุต ูู:
- `components/ImageUpload.tsx`
- `app/dashboard/categories/new/page.tsx`
- `app/dashboard/categories/edit/[type]/page.tsx`
- `app/api/categories/route.ts`
- `app/api/categories/[type]/route.ts`

---

**ุงูุชุงุฑูุฎ:** 2025-10-14  
**ุงูุญุงูุฉ:** โ ุชู ุงูุฅุตูุงุญ  
**ุงููุดููุฉ:** Race condition - ุงูุญูุธ ูุจู ุงูุชูุงู ุฑูุน ุงูุตูุฑุฉ  
**ุงูุญู:** ุชุนุทูู ุฒุฑ ุงูุญูุธ ุญุชู ุชูุชูู ุนูููุฉ ุงูุฑูุน
