# دليل اختبار وإصلاح نظام التقييمات

## المشكلة
التقييمات لا تظهر في صفحة المنتج

## الأسباب المحتملة

### 1. التقييمات معطلة في الإعدادات
**الفحص:** افتح المتصفح وادخل على:
```
http://localhost:3000/api/test-reviews
```

**ابحث عن:**
- `reviews_enabled` في الإعدادات
- إذا كانت القيمة `false` أو غير موجودة، هذه هي المشكلة

**الحل:**
افتح قاعدة البيانات Supabase وقم بتشغيل:
```sql
-- التأكد من وجود الإعداد
INSERT INTO site_settings (key, value) 
VALUES ('reviews_enabled', 'true')
ON CONFLICT (key) 
DO UPDATE SET value = 'true';
```

### 2. لا توجد تقييمات في قاعدة البيانات
**الفحص:** من نفس الرابط أعلاه، ابحث عن `total_reviews`

**الحل:** أضف تقييم تجريبي
```sql
-- الحصول على ID منتج موجود
SELECT id, name FROM products LIMIT 1;

-- إضافة تقييم تجريبي (استبدل PRODUCT_ID_HERE بـ ID المنتج)
INSERT INTO reviews (product_id, reviewer_name, rating, comment)
VALUES (
  'PRODUCT_ID_HERE',
  'مستخدم تجريبي',
  5,
  'منتج ممتاز! أنصح به بشدة. هذا تقييم تجريبي للاختبار.'
);
```

### 3. مشكلة في API
**الفحص:** افتح Developer Console في المتصفح (F12)
- اذهب إلى تبويب Network
- افتح صفحة منتج
- ابحث عن طلب API: `/api/products/[id]/reviews`
- افحص الرد (Response)

**الأخطاء الشائعة:**
- Status 404: API endpoint غير موجود
- Status 500: خطأ في الخادم
- CORS Error: مشكلة في الأذونات

### 4. المكون غير مستدعى
**الفحص:** افحص كود `ProductClient.tsx`

**تم الإصلاح بالفعل** ✅ - تم إضافة:
```tsx
<div className="mb-16">
  <h2 className="text-2xl font-bold text-gray-900 mb-8">تقييمات المنتج</h2>
  <ProductReviews productId={product.id} />
</div>
```

## خطوات الاختبار الكاملة

### الخطوة 1: اختبار API
```bash
# في المتصفح، افتح:
http://localhost:3000/api/test-reviews
```

سترى تقرير كامل يوضح:
- ✅ حالة جدول التقييمات
- ✅ إعداد reviews_enabled
- ✅ عدد التقييمات لكل منتج
- ⚠️ التوصيات والإصلاحات المطلوبة

### الخطوة 2: تفعيل التقييمات
إذا كانت معطلة، نفذ SQL أعلاه في Supabase

### الخطوة 3: إضافة تقييمات تجريبية
```sql
-- مثال: إضافة 3 تقييمات لمنتج معين
INSERT INTO reviews (product_id, reviewer_name, rating, comment) VALUES
('PRODUCT_ID', 'أحمد محمد', 5, 'منتج رائع جداً! جودة ممتازة وسعر مناسب.'),
('PRODUCT_ID', 'فاطمة علي', 4, 'جيد بشكل عام، لكن التوصيل كان متأخر قليلاً.'),
('PRODUCT_ID', 'محمود حسن', 5, 'أفضل منتج اشتريته! أنصح به بشدة.');
```

### الخطوة 4: اختبار الصفحة
1. افتح صفحة منتج مثل: `/product/electricswitch`
2. يجب أن ترى قسم "تقييمات المنتج"
3. إذا كانت التقييمات معطلة، ستظهر رسالة تحذير صفراء
4. إذا لم يكن هناك تقييمات، ستظهر رسالة "لا توجد تقييمات بعد"

## الحالات المختلفة

### حالة 1: التقييمات معطلة
```
┌─────────────────────────────────────────┐
│  📢 التقييمات معطلة حالياً             │
│  نظام التقييمات غير مفعّل في الموقع   │
└─────────────────────────────────────────┘
```

### حالة 2: لا توجد تقييمات
```
┌─────────────────────────────────────────┐
│  متوسط التقييم: 0.0 ⭐⭐⭐⭐⭐         │
│  0 تقييم                                │
│                                         │
│  💬 لا توجد تقييمات بعد                │
│  كن أول من يقيم هذا المنتج!            │
└─────────────────────────────────────────┘
```

### حالة 3: توجد تقييمات (طبيعي)
```
┌─────────────────────────────────────────┐
│  متوسط التقييم: 4.7 ⭐⭐⭐⭐⭐         │
│  3 تقييمات                              │
│                                         │
│  ⭐⭐⭐⭐⭐  أحمد محمد               │
│  منتج رائع جداً!...                    │
└─────────────────────────────────────────┘
```

## استكشاف الأخطاء

### الخطأ: "reviews_enabled غير موجود"
**السبب:** الإعداد غير موجود في جدول site_settings
**الحل:** نفذ SQL لإضافة الإعداد

### الخطأ: "Cannot read property 'id' of undefined"
**السبب:** product.id غير موجود
**الحل:** تأكد من تمرير product.id بشكل صحيح للمكون

### الخطأ: API يعيد []
**السبب:** لا توجد تقييمات للمنتج
**الحل:** أضف تقييمات تجريبية

## الملفات المهمة

1. **Frontend:**
   - `app/product/[slug]/ProductClient.tsx` - صفحة المنتج
   - `app/components/ProductReviews.tsx` - مكون التقييمات

2. **Backend:**
   - `app/api/products/[id]/reviews/route.ts` - API التقييمات
   - `app/api/test-reviews/route.ts` - API الاختبار

3. **Database:**
   - جدول `reviews` - تخزين التقييمات
   - جدول `site_settings` - الإعدادات

## الدعم

إذا استمرت المشكلة، افحص:
1. Console في المتصفح للأخطاء JavaScript
2. Network Tab للتأكد من نجاح API calls
3. Supabase Dashboard لفحص البيانات مباشرة
