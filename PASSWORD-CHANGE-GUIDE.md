# دليل تغيير كلمة المرور للمديرين
## Password Change Guide for Admins

## 📋 نظرة عامة | Overview

تم تحسين نظام تغيير كلمة المرور بالكامل ليشمل:
- ✅ معايير قوة كلمة المرور المحسّنة
- ✅ مؤشرات مرئية لقوة كلمة المرور
- ✅ رسائل خطأ واضحة ومفصلة
- ✅ تحسين تجربة المستخدم في الحقول
- ✅ حماية محسّنة ضد الهجمات

---

## 🔐 معايير كلمة المرور | Password Requirements

يجب أن تحتوي كلمة المرور الجديدة على:

### المتطلبات الإلزامية:
1. **الطول**: 8 أحرف على الأقل
2. **حرف كبير**: على الأقل حرف واحد (A-Z)
3. **حرف صغير**: على الأقل حرف واحد (a-z)
4. **رقم**: على الأقل رقم واحد (0-9)
5. **رمز خاص**: على الأقل رمز واحد (!@#$%^&*...)

### أمثلة على كلمات مرور صحيحة:
- ✅ `Admin@2025`
- ✅ `MyP@ssw0rd!`
- ✅ `Secure#Pass123`
- ✅ `Alagayebi@2025`

### أمثلة على كلمات مرور غير صحيحة:
- ❌ `admin123` (لا يحتوي على حرف كبير ورمز خاص)
- ❌ `ADMIN@2025` (لا يحتوي على حرف صغير)
- ❌ `Admin@Pass` (لا يحتوي على رقم)
- ❌ `Admin123` (لا يحتوي على رمز خاص)

---

## 👤 سيناريوهات تغيير كلمة المرور

### 1️⃣ مدير يغير كلمة مروره الخاصة
**المتطلبات:**
- ✅ إدخال كلمة المرور القديمة (إلزامي)
- ✅ إدخال كلمة المرور الجديدة (بالمعايير المطلوبة)
- ✅ تأكيد كلمة المرور الجديدة

**ما يحدث بعد التغيير:**
- ✅ تظهر رسالة نجاح
- ⏰ بعد 1.5 ثانية، يتم تسجيل الخروج تلقائياً
- 🔄 يجب تسجيل الدخول مرة أخرى بكلمة المرور الجديدة

### 2️⃣ مدير رئيسي يغير كلمة مرور مدير آخر
**المتطلبات:**
- ⚠️ لا حاجة لإدخال كلمة المرور القديمة
- ✅ إدخال كلمة المرور الجديدة فقط
- ✅ تأكيد كلمة المرور الجديدة

**ما يحدث بعد التغيير:**
- ✅ تظهر رسالة نجاح
- 🔄 المدير المستهدف سيحتاج لتسجيل الدخول بكلمة المرور الجديدة

---

## 🎨 المؤشرات المرئية | Visual Indicators

### مؤشرات قوة كلمة المرور:
عند كتابة كلمة المرور الجديدة، ستظهر مؤشرات ملونة:

- 🟢 **أخضر** = المتطلب مُستوفى
- ⚪ **رمادي** = المتطلب غير مُستوفى

### مؤشر التطابق:
- ✅ **أخضر مع ✓**: كلمات المرور متطابقة
- ❌ **أحمر مع ✗**: كلمات المرور غير متطابقة

---

## ⚠️ رسائل الخطأ الشائعة

| الرسالة | السبب | الحل |
|---------|--------|------|
| كلمة المرور يجب أن تحتوي على 8 أحرف على الأقل | كلمة المرور قصيرة | أضف المزيد من الأحرف |
| كلمة المرور يجب أن تحتوي على حرف كبير | لا يوجد حرف كبير | أضف حرف كبير (A-Z) |
| كلمة المرور يجب أن تحتوي على رمز خاص | لا يوجد رمز خاص | أضف رمز مثل !@#$% |
| كلمات المرور غير متطابقة | التأكيد غير مطابق | تأكد من التطابق التام |
| كلمة المرور القديمة غير صحيحة | كلمة المرور القديمة خاطئة | أدخل كلمة المرور الصحيحة |
| انتهت جلستك | انتهت صلاحية الجلسة | سجل الدخول مرة أخرى |

---

## 🔒 الصلاحيات والأمان

### من يمكنه تغيير كلمة المرور؟

#### ✅ مسموح:
1. **المدير نفسه**: يمكن تغيير كلمة مروره الخاصة (مع إدخال القديمة)
2. **المدير الرئيسي (Super Admin)**: يمكن تغيير كلمة مرور أي مدير آخر (بدون القديمة)

#### ❌ غير مسموح:
1. **المدير العادي**: لا يمكنه تغيير كلمة مرور مدير آخر
2. **بدون تسجيل دخول**: يجب أن تكون مسجل دخول

### الحماية من الهجمات:
- 🛡️ تشفير كلمات المرور باستخدام Argon2id
- 🛡️ التحقق من القوة على مستوى العميل والخادم
- 🛡️ Rate limiting لمنع محاولات التخمين
- 🛡️ تسجيل جميع محاولات التغيير

---

## 📱 كيفية الاستخدام | How to Use

### خطوات تغيير كلمة المرور:

1. **افتح لوحة التحكم**
   - اذهب إلى `/dashboard/admins`

2. **اختر المدير**
   - انقر على أيقونة المفتاح 🔑 بجانب اسم المدير

3. **أدخل البيانات**
   - كلمة المرور القديمة (إذا كنت تغير كلمة مرورك)
   - كلمة المرور الجديدة (بالمعايير المطلوبة)
   - تأكيد كلمة المرور الجديدة

4. **تحقق من المؤشرات**
   - تأكد من أن جميع المؤشرات خضراء ✅
   - تأكد من تطابق كلمات المرور

5. **احفظ التغييرات**
   - انقر على زر "تغيير كلمة المرور"
   - انتظر رسالة النجاح

6. **سجل الدخول مرة أخرى** (إذا غيرت كلمة مرورك الخاصة)

---

## 🔧 للمطورين | For Developers

### API Endpoint:
```
POST /api/admin/users/change-password
```

### Request Body:
```json
{
  "adminId": "uuid-of-admin",
  "oldPassword": "old-password-here", // Optional for super admins
  "newPassword": "new-strong-password",
  "confirmPassword": "new-strong-password"
}
```

### Response (Success):
```json
{
  "success": true,
  "message": "تم تغيير كلمة المرور بنجاح"
}
```

### Response (Error):
```json
{
  "success": false,
  "error": "رسالة الخطأ هنا"
}
```

### Validation:
- استخدام `zod` للتحقق من البيانات
- التحقق من القوة باستخدام regex patterns
- التحقق من الصلاحيات قبل التنفيذ

### Database Functions:
- `check_admin_password()` - التحقق من كلمة المرور القديمة
- `change_admin_password()` - تغيير كلمة المرور
- `create_admin_user()` - إعادة إنشاء المدير بكلمة مرور جديدة (للمدير الرئيسي)

---

## 📞 الدعم والمساعدة

في حالة مواجهة أي مشاكل:
1. تأكد من استيفاء جميع المعايير
2. راجع رسائل الخطأ بعناية
3. تحقق من صلاحياتك
4. تأكد من اتصالك بالإنترنت
5. حاول تسجيل الخروج والدخول مرة أخرى

---

## ✨ التحديثات الأخيرة

### الإصدار الحالي:
- ✅ إضافة مؤشرات مرئية لقوة كلمة المرور
- ✅ تحسين رسائل الخطأ
- ✅ إضافة التحقق من قوة كلمة المرور
- ✅ تحسين واجهة المستخدم
- ✅ إضافة مؤشر التحميل
- ✅ تسجيل الخروج التلقائي بعد تغيير كلمة المرور الخاصة
- ✅ منع إرسال النموذج إذا كانت كلمات المرور غير متطابقة

---

**تم التطوير بواسطة:** فريق Al-Agayebi  
**آخر تحديث:** 2025-10-20  
**الإصدار:** 2.0.0
